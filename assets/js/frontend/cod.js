/*!*******************************************************
*
* Lexus cod.js
*
* @version: 3.6
* @date: 2014.12.08 08:54
*
* THIS IS A GENERATED FILE - DO NOT MODIFY HERE
*
*********************************************************/


if(!window.tmsomnixd){window.tmsomnixd={}}tmsomnixd.config=function(){var h,c,b,a,e,i,j,d,g;try{h=!!(/(tstcpd\d\.|devcpd\d\.|staging\.|qa\.|\.local|localhost)/g.test(document.domain))}catch(f){h=false}if(h){d="http://staging.lexus.com/lexus-share/js/tracking_omn/";g="https://secure.staging.lexus.com/lexus-share/js/tracking_omn/"}else{d="http://www.lexus.com/lexus-share/js/tracking_omn/";g="https://secure.lexus.com/lexus-share/js/tracking_omn/"}c=d+"omnixd.swf";b=g+"omnixd.swf";a=d+"LX_cod_2_0.js";e=g+"LX_cod_2_0.js";i=d+"sync.html";j=g+"sync.html";return{fallback:{fbURL:a,fbSecureURL:e},fconn:{swfURL:c,swfSecureURL:b,flashvars:{brandid:"lexus",debug:false}},h5conn:{xconURL:i,xconSecureURL:j},dart:{staticsrc:"1044889",type:"lexus764"},ns:"tmsomni",fireTag:{ns:"tmsomni",SiteCatalyst:{namespace:"tmsomni",dedup:false}},MediaTrack:{ns:"tmsomni",playerName:"lexus"},log:{debug:false}}}();(function(a,b){var e=!!b;if(!a.Log){var d={add:function(f){if(!f||!f.toString){return}var c="";if(arguments.callee&&arguments.callee.caller&&arguments.callee.caller.name){c=arguments.callee.caller.name+":"}this.history.push(c+f.toString());if(this.history.length>400){this.history.shift()}},history:[],info:function(c){this.add(c)},warn:function(c){this.add(c)},log:function(c){this.add(c)},debug:function(c){this.add(c)}};a.Log=(a.console&&console.debug&&console.info&&console.warn&&console.log&&e)?a.console:d}})(window,(window.tmsomnixd&&tmsomnixd.config&&tmsomnixd.config.log&&tmsomnixd.config.log.debug));var baker=function(b){if(window.console&&(typeof(console.log)=="function"||typeof(console.log)=="object")){try{window.console.log(b)}catch(a){}}};(function(c,d){d[c]=d[c]||{};var e=d[c],b,a;e.config=e.config||{};e.utils=e.utils||{};b=e.config;a=e.utils;b.fireTag=b.fireTag||{};b.MediaTrack=b.MediaTrack||{playerName:"toyota"};a.mergeObject=a.mergeObject||function(g,h){var f={},i;for(i in g){if(g.hasOwnProperty(i)){f[i]=g[i]}}for(i in h){if(h.hasOwnProperty(i)){f[i]=h[i]}}return f}})("tmsomnixd",window);(function(c,s){var o=s.config||{};o.fireTag=o.fireTag||{};var j=Object.prototype.hasOwnProperty,b=[],d=function(v,w,y){var u={},z=(y!==undefined)?y:true;for(var A in v){if(v.hasOwnProperty(A)){u[A]=v[A]}}if(z){for(var x in w){if(w.hasOwnProperty(x)){u[x]=w[x]}}}return u},m=(function(z){var w="SiteCatalyst",y=/^(prop|eVar|list|channel|linkType|events|linkName|mediaTitle|pageName|_|ck_|cv_|ss_|trackExternalLinks|trackDownloadLinks)/,x={namespace:"s",dynamicParamAdapter:null,dedup:false},v=x,A=z[w];if(typeof z[w]==="object"){v=d(x,A)}function u(D,C,L){var K,J,E,B,F,H,M;try{if(typeof(v.dynamicParamAdapter)==="function"){K=v.dynamicParamAdapter(D,C,L)||{};D=K.id||D;C=K.dv||C;L=K.json||L}F=v.dedup;J=window[v.namespace];if(!J){baker("error: Omniture Site Catalyst is missing");e("ERROR_NO_ANALYTICS",D);return}if(!J.tl){baker("error: Omniture Site Catalyst is overwritten");e("ERROR_NO_ANALYTICS",D);return}M={};H=q(J,C,L,F,M);J._tagID=D;M._tagID=D;g(D,C,L,M);n(J,M);H=v.namespace+":\n"+H;if(H!==""){if(L._sc_cmd!=="abort"){baker("codeblock "+D+" found to contain:\n"+H);try{if(J.linkType){J.tl(this,J.linkType,J.linkName);baker("codeblock "+D+" Link Sent")}else{J.t();baker("codeblock "+D+" Page Load Sent")}}catch(G){baker("error: codeblock "+D+" was not sent");baker(G);e("ERROR_TAG_NOT_FIRED",D)}}else{baker("codeblock "+D+" found to contain:\n"+H);baker("codeblock "+D+" success")}}if(!J.target){H="";J._tagLog=J._tagLog||[];J._tagLog.push(J._tagID);J._tagID="";for(var E in L){if(L.hasOwnProperty(E)){J[E]=""}}}}catch(I){baker("error: unknown "+w+" error");baker(I);e("ERROR_UNKNOWN_TAG_ERROR",D)}}return{type:w,propRegex:y,defaults:x,trigger:u}})(o.fireTag),t=(function(z){var w="Adometry",y=/^(gid|advid|pid|rev)$/,x={url:"http://js.dmtry.com/channel.js",surl:"https://log.dmtry.com/channel.js",dynamicParamAdapter:null,dedup:false},v=(typeof z[w]==="object")?d(x,z[w]):x;function u(E,C,M){var K={},L,H,J,F,G,D,B,A;try{J=(location.protocol==="https:");F=v.dedup;if(typeof(v.dynamicParamAdapter)==="function"){L=v.dynamicParamAdapter(E,C,M)||{};E=L.id||E;C=L.dv||C;M=L.json||M}G="";G=q(K,C,M,F);A=(J)?v.surl:v.url+"#gid:"+K.gid+";advid:"+K.advid+";pid:"+K.pid+((K.rev)?";rev:"+K.rev:"")+";";f(A,function(){baker("Adometry loaded\n"+G)})}catch(I){baker("error: unknown "+w+" error");baker(I)}}return{type:w,propRegex:y,defaults:x,trigger:u}})(o.fireTag),l=(function(z){var w="TestAndTarget",y=/^(mb_)/,x={dynamicParamAdapter:null},v=(typeof z[w]==="object")?mergedObj(x,z[w]):x;function u(E,C,P){var M={},O,G,L,H,D,B,A,K,N,F;try{L=(location.protocol==="https:");if(typeof(v.dynamicParamAdapter)==="function"){O=v.dynamicParamAdapter(E,C,P)||{};E=O.id||E;C=O.dv||C;P=O.json||P}H="";H=q(M,C,P,dedup);for(var I in M){K=I.substr(3);F=M[I]||"";F=F.split(",");N=F.shift();if("mboxUpdate"==N){if(typeof mboxUpdate==="function"){try{F.unshift(K);mboxUpdate.apply(null,F)}catch(J){baker("error:"+w+" error: error calling "+N+" on "+K)}}}if("mboxTrack"===N){if(typeof mboxTrack==="function"){try{mboxTrack(K,F.join("&"))}catch(J){baker("error:"+w+" error: error calling "+N+" on "+K)}}}}}catch(J){baker("error: unknown "+w+" error");baker(J)}}return{type:w,propRegex:y,defaults:x,trigger:u}})(o.fireTag),r=(function(z){var w="Korrelate",y=/^(lvl|av1|av2|av3)$/i,x={devurl:"http://a02.korrelate.net/a/e/d2a.ads?et=a&ago=292&ao=293&px=178&pt=s&r=",devsurl:"https://a01.korrelate.net/a/e/d2a.adset=a&ago=292&ao=293&px=178&pt=s&r=",produrl:"http://a02.korrelate.net/a/e/d2a.ads?et=a&ago=292&ao=294&px=179&r=",prodsurl:"https://a01.korrelate.net/a/e/d2a.ads?et=a&ago=292&ao=294&px=179&r=",dynamicParamAdapter:null,isDev:true},v=(typeof z[w]==="object")?d(x,z[w]):x;function u(G,D,O){var M={},N,J,L,H,F,I,E,C,B,A;try{L=(location.protocol==="https:");H=v.isDev;F=v.dedup;if(typeof(v.dynamicParamAdapter)==="function"){N=v.dynamicParamAdapter(G,D,O)||{};G=N.id||G;D=N.dv||D;O=N.json||O}I=q(M,D,O,F);A=parseInt(Math.random()*1000000000000,10);if(H){B=(L)?v.devsurl:v.devurl}else{B=(L)?v.prodsurl:v.produrl}B+=A;B+="&lvl="+M.lvl;B+=(M.av1)?"&av1="+M.av1:"";B+=(M.av2)?"&av2="+M.av2:"";B+=(M.av3)?"&av3="+M.av3:"";f(B,function(){baker(w+" loaded\n"+I)})}catch(K){baker("error: unknown "+w+" error");baker(K)}}return{type:w,propRegex:y,defaults:x,trigger:u}})(o.fireTag);b.push(m);b.push(r);b.push(l);b.push(t);function i(v){try{if(!v||v.length===0){baker("error: the tag id cannot be null");e("ERROR_TAGID_NULL",v);return}if(!window.taglist){baker("error: JSON file not included");e("ERROR_NO_JSON",v);return}json=taglist["F"+String(v).replace(".","X")];if(!json){baker("error: Included JSON file does not contain codeblock "+v);e("ERROR_NO_ID_IN_JSON",v);return}return json}catch(u){baker("error: unknown error retrieving codeblock "+v);e("ERROR_UNKOWN_JSON_ERROR",v);return}}function q(A,w,F,D,x){var E,B=[],v,C,z,G={};x=x||{};for(var y in F){if(F.hasOwnProperty(y)){E=F[y];for(var u in w){if(w.hasOwnProperty(u)){if(F[y].indexOf(u)!==-1){if(E===F[y]){E=F[y].replace(u,w[u])}else{E=E.replace(u,w[u])}}}}v=E.substr(3);z=E;if(z.match(/^cv_/i)){if(!A.contextData){A.contextData={}}E=A.contextData[v]}else{if(z.match(/^ck_/i)){E=a(v)}else{if(z.match(/^ss_/i)){if(window.sessionStorage){if(!G.hasOwnProperty(v)){G[v]=window.sessionStorage.getItem(v);window.sessionStorage.removeItem(v)}E=G[v]}}}}if(D){if(E.match(/^:|::|:$/g)){E=E.replace(/:+/g,":").replace(/(^:|:$)/g,"")}if(E.match(/^_|__|_$/g)){E=E.replace(/_+/g,"_").replace(/(^_|_$)/g,"")}}v=y.substr(3);if(y.match(/^cv_/i)){if(!A.contextData){A.contextData={}}A.contextData[v]=E;x.contextData=x.contextData||{};x.contextData[v]=E;C="contextData."+v}else{if(y.match(/^ck_/i)){k(v,E);x.cookie=x.cookie||{};x.cookie[v]=E;C="cookie:"+v}else{if(y.match(/^ss_/i)){if(window.sessionStorage){window.sessionStorage.setItem(v,E);x.session=x.session||{};x.session[v]=E;C="session:"+v}else{C="NO sessionStorage for "+v}}else{A[y]=E;x[y]=E;C=y}}}B.push(C+" = "+E)}}return B.join("\n")}function f(v,w){var u=document.createElement("script");u.type="text/javascript";if(u.readyState){u.onreadystatechange=function(){if(u.readyState=="loaded"||u.readyState=="complete"){u.onreadystatechange=null;w()}}}else{u.onload=function(){w()}}u.src=v;document.getElementsByTagName("head")[0].appendChild(u)}function a(v){var x,u,w=document.cookie;if(w.length>0){x=w.indexOf(v+"=");if(x!==-1){x=x+v.length+1;u=w.indexOf(";",x);if(u===-1){u=w.length}return unescape(w.substring(x,u))}}return""}function k(u,A,w,x,C){var v=";path="+((C)?C:"/"),y=(x)?";domain="+x:";",B,z=new Date();B=";";if(w&&!isNaN(w)){z.setDate(z.getDate()+w);B=";expires="+z.toUTCString()+";"}document.cookie=u+"="+A+y+v+B}function g(B,y,x,w){var v=10,u,A;try{u=document.createEvent("Event");u.initEvent("AnalyticsEvent",true,false);u.details={command:"fireTag",id:B,dv:y,json:x||{},data:w||{}};document.dispatchEvent(u)}catch(z){}}function n(v,w){var u=10,y="";if(v){v.analyticLog=v.analyticLog||[];try{y=JSON.stringify(w);v.analyticLog.push(y);if(v.analyticLog.length>u){v.analyticLog=v.analyticLog.slice(-u)}}catch(x){}}}function h(v){var u;try{u=document.createEvent("Event");u.initEvent("AnalyticsEvent",true,false);u.details=v;document.dispatchEvent(u)}catch(w){}}function e(E,C){var E=E||"unknown",C=C||"",G=(window.location.protocol==="https:")?"https://smetrics":"http://metrics",A=(document.domain.match(/^(www|auth\d*?|secure|touch|ssl|drivers|m|access)\./i)?"tmslexusexternal":"tmsdevlexusexternal"),v=".lexus.com/b/ss/"+A+"/5.4/REDIR/?",z=window.location,D,H,F,y,x,u,w;try{H=encodeURIComponent(z.href.toLowerCase());y=encodeURIComponent(z.host.toLowerCase());x=encodeURIComponent(z.pathname.toLowerCase());F=y+x;u=G+v+"v0="+E+"&c25="+E+"&c26="+C+"&c48="+H+"&c49="+F+"&c64="+y+"&c65="+x+"&pe=lnk_o&pev1=D=url&pev2=tag_error&url="+H;w=document.createElement("img");w.style="display:none;";w.width=w.height=1;w.src=u;document.getElementsByTagName("head")[0].appendChild(w)}catch(B){baker("could not send error")}}function p(v,u){var w,B,C,D,A,E=i(v);if(!E){g(v,u,{},{});return}if(b.length<1){baker("No tag libraries defined");e("ERROR_NO_JSON",v);return}u=u||{};if("object"==typeof(omni_page_var)){u=d(omni_page_var,u)}for(var x=0,y=b.length;x<y;x++){B=b[x];try{C={};D=false;for(var w in E){if(E.hasOwnProperty(w)){if(!!w.match(B.propRegex)){C[w]=E[w];D=true}}}if(D){B.trigger(v,u,C)}}catch(z){baker("error: unknown error with "+B.type+" tag");e("ERROR_UNKNOWN_TAG_ERROR",v)}}}c.fireTag=p;h({command:"load",type:"cod"})})(window,tmsomnixd);var MediaTrack=function(h,g,f,l){baker("MediaTrack("+h+","+g+","+f+","+l+")");l=l||{};var c=(tmsomnixd&&tmsomnixd.config)?tmsomnixd.config:{},e=(tmsomnixd&&tmsomnixd.utils)?tmsomnixd.utils.mergeObject:null,o=(c.ns)?c.ns:"s",w=window[o],n=(c.MediaTrack)?c.MediaTrack:{},j=(n)?n.dynamicParamAdapter:null,d=(n)?n.playerName:"Player",u,a,i,k,v;if("object"==typeof(window.omni_page_var)){if(e){l=e(omni_page_var,l)}}if(j&&(typeof j==="function")){k=j(h,g,f,l)||{};h=k.x||h;g=k.y||g;f=k.z||f;l=k.dv||l}try{u=h;if(!(/[^0-9|.]/gi.test(h))){v=taglist["F"+String(h).replace(".","X")];if(v&&v.mediaTitle){u=v.mediaTitle.toString()}}for(var m in l){if(l.hasOwnProperty(m)){if(u.indexOf(m)!==-1){u=u.replace(m,l[m])}}}if(!w){baker("error: Omniture Site Catalyst is missing");return}if(!w.Media){baker("error: Omniture Site Catalyst is overwritten");return}if(g==="MediaOpen"){baker("open:"+u);try{w.Media.open(u,f,d);baker("MediaOpen Tracked!")}catch(b){baker("error: Did not track MediaOpen.")}}else{if(g==="MediaPlay"){baker("play:"+u);try{w.Media.play(u,f);baker("MediaPlay Tracked!")}catch(t){baker("error: Did not track MediaPlay.");baker(t)}}else{if(g==="MediaStop"){baker("stop:"+u);try{w.Media.stop(u,f);baker("MediaStop Tracked!")}catch(s){baker("error: Did not track MediaStop.");baker(s)}}else{if(g==="MediaClose"){baker("end:"+u);try{w.Media.stop(u,f);w.Media.close(u);baker("MediaEnd Tracked!")}catch(r){baker("error: Did not track MediaEnd.");baker(r)}}}}}}catch(p){baker("error: Codeblock not found.");baker(p)}};if(!window.tmsomnixd){window.tmsomnixd={}}if(!tmsomnixd.utils){tmsomnixd.utils={}}(function(a){a.mergeObject=function(b,c,f){var d=(f)?true:false,h;for(h in c){if(c.hasOwnProperty(h)&&(d)?b.hasOwnProperty(h):true){try{if(c[h].constructor===Object){if(!b[h]){b[h]={}}b[h]=mergeObject(b[h],c[h],d)}else{b[h]=c[h]}}catch(g){b[h]=c[h]}}}return b};a.HTML5Support=(function(f){var b,d,e,c;b=(function(){try{return !!f.localStorage.getItem}catch(g){return false}})();d=!!f.postMessage;e=!!f.JSON;c=(b&&d&&e);return{hasLS:b,hasPM:d,hasJSON:e,hasRequired:c}})(window);a.isDOMReady=function(){return document.readyState==="complete"};a.addOnLoadEvent=function(b){if(typeof b!="function"){return}if(document.readyState==="complete"){b()}else{if(window.attachEvent){window.attachEvent("onload",b)}else{if(window.addEventListener){window.addEventListener("load",b,false)}else{document.addEventListener("load",b,false)}}}};a.includeScript=function(c,g){var d,e,f,b;d=document.getElementsByTagName("head").item(0);e=document.createElement("script");f=(function(h){return function(){if(typeof h==="function"){h();h=null}}})(g);e.type="text/javascript";e.src=c;if(typeof g=="function"){e.onload=f;e.onreadystatechange=function(i){var h=g,j=(i&&i.currentTarget&&i.currentTarget.readyState)?i.currentTarget.readyState:"loaded";if(j=="loaded"||j=="complete"){f()}}}d.appendChild(e);return false};a.getDomain=function(c){var b=c.split(".");if(b.length>2){c="."+b[b.length-2]+"."+b[b.length-1]}else{c=""}return c};a.createCallbackClosure=function(c,d,b){return function(){var e=Array.prototype.slice.call(arguments);if(b){if(typeof b.slice!=="function"){b=[b]}e=e.concat(b)}d.apply(c,e)}};a.writeCookie=function(b,h,d,e,j){var c=";path="+((j)?j:"/"),f=(e)?";domain="+e:";",i,g=new Date();i=";";if(d&&!isNaN(d)){g.setDate(g.getDate()+d);i=";expires="+g.toUTCString()+";"}document.cookie=b+"="+h+f+c+i};a.readCookie=function(c){var d,b;if(document.cookie.length>0){d=document.cookie.indexOf(c+"=");if(d!==-1){d=d+c.length+1;b=document.cookie.indexOf(";",d);if(b===-1){b=document.cookie.length}return unescape(document.cookie.substring(d,b))}}return""}})(tmsomnixd.utils);if(!window.tmsomnixd){window.tmsomnixd={}}if(!tmsomnixd.classes){tmsomnixd.classes={}}tmsomnixd.classes.EventDispatcher=(function(){var a=function(){this.lo={}};a.prototype.addEventListener=function(b,c){if(typeof(b)!=="string"||typeof(c)!=="function"){return}if(typeof this.lo[b]==="undefined"){this.lo[b]=[]}this.lo[b].push(c)};a.prototype.removeEventListener=function(d,e){if(typeof(d)!=="string"||typeof(e)!=="function"){return}if(this.lo[d] instanceof Array){var f=this.lo[d];for(var c=0,b=f.length;c<b;c+=1){if(f[c]===e){f.splice(c,1);break}}}};a.prototype.dispatchEvent=function(e){if(!(e&&e.type)){return}if(this.lo[e.type] instanceof Array){var f=(this.lo[e.type]).slice(0);for(var c=0,b=f.length;c<b;c+=1){try{f[c].call(this,e)}catch(d){}}}};return a})();if(!window.tmsomnixd){window.tmsomnixd={}}if(!tmsomnixd.classes){tmsomnixd.classes={}}tmsomnixd.classes.Poll=(function(a){var b=function(d,c){this.defaultInterval=200;this.defaultMaxAttempts=1;this.ed=new a();this.maxAttempts=(isNaN(c))?this.defaultMaxAttempts:c;this.attempt=0;this.inprogress=false;this.delayMS=(isNaN(d))?this.defaultInterval:d;this.pollTO=-1;this.done=false};b.EVENT_CHECK="poll_check";b.EVENT_SUCCESS="poll_success";b.EVENT_FAILED="poll_failed";b.EVENT_STOPPED="poll_stopped";b.SUCCESS="success";b.FAIL="fail";b.CONTINUE="continue";b.STOP="stop";b.prototype.start=function(){if(!this.inprogress){this.inprogress=true;this.attempt=1;this.done=false;this.delay()}};b.prototype.stop=function(){if(this.inprogress){this.inprogress=false;this.done=true;clearTimeout(this.pollTO);this.setResult(b.EVENT_STOPPED)}};b.prototype.delay=function(){if(this.attempt<this.maxAttempts){var c=(function(d){return function(){d.check()}})(this);this.pollTO=setTimeout(c,this.delayMS)}else{this.de(b.EVENT_FAILED)}};b.prototype.check=function(){this.de(b.EVENT_CHECK)};b.prototype.de=function(c){var d={type:c,target:this,attempt:this.attempt,maxAttempts:this.maxAttempts};this.ed.dispatchEvent(d)};b.prototype.addEventListener=function(c,d){return this.ed.addEventListener(c,d)};b.prototype.removeEventListener=function(c,d){return this.ed.removeEventListener(c,d)};b.prototype.isInProgress=function(){return this.inprogress};b.prototype.setResult=function(c){switch(c){case b.SUCCESS:this.done=true;this.de(b.EVENT_SUCCESS);break;case b.FAIL:this.done=true;this.de(b.EVENT_FAILED);break;case b.STOP:this.done=true;this.de(b.EVENT_STOPPED);break;case b.CONTINUE:if(!this.done){this.attempt++;this.delay()}break}};return b})(tmsomnixd.classes.EventDispatcher);if(!window.tmsomnixd){window.tmsomnixd={}}if(!tmsomnixd.classes){tmsomnixd.classes={}}tmsomnixd.classes.Queue=(function(a){var b=function(){this.ed=new a();this._q=[];this.inprogress=false;this.delay=100};b.EVENT_CHANGE="queue_change";b.EVENT_UPDATE="queue_update";b.EVENT_START="queue_start";b.EVENT_COMPLETE="queue_complete";b.EVENT_STOP="queue_stop";b.prototype.enqueue=function(c){this._q.push(c);this.to=-1;this.stopped=false};b.prototype.dequeue=function(){var c=this._q.shift();return c};b.prototype.process=function(){var c;if(!this.inprogress){this.stopped=false;this.inprogress=true;this.de(b.EVENT_START,"");this._process()}};b.prototype._process=function(){var c,d;if(!this.stopped){if(this.getAmountQueued()>0){c=this.dequeue();this.de(b.EVENT_UPDATE,c);if(this.getAmountQueued()>0){d=(function(e){return function(){e._process()}})(this);this.to=setTimeout(d,this.delay)}else{this.inprogress=false;this.de(b.EVENT_COMPLETE,"")}}else{this.inprogress=false;this.de(b.EVENT_COMPLETE,"")}}};b.prototype.stop=function(){clearTimeout(this.to);this.stopped=true;this.inprogress=false;this.de(b.EVENT_STOP,"")};b.prototype.getAmountQueued=function(){return this._q.length};b.prototype.isProcessing=function(){return this.inprogress};b.prototype.addEventListener=function(c,d){return this.ed.addEventListener(c,d)};b.prototype.removeEventListener=function(c,d){return this.ed.removeEventListener(c,d)};b.prototype.de=function(c,d){var f={type:c,target:this,amountQueued:this.getAmountQueued(),data:(d)?d:""};this.ed.dispatchEvent(f)};return b})(tmsomnixd.classes.EventDispatcher);if(!window.tmsomnixd){window.tmsomnixd={}}if(!tmsomnixd.classes){tmsomnixd.classes={}}tmsomnixd.classes.H5XD=(function(b,a){var c=function(){this.SYNC_RESULTS_EVENT="xd_sync_results";this.COM_STATUS_EVENT="xd_com_status";this.SYNC_STATUS_EVENT="xd_sync_status";this.RECEIVE_XD_MESSAGE_EVENT="xd_receive_message";this.COM_NOTINITIALIZED="COM_NOTINITIALIZED";this.COM_CONNECTING="COM_CONNECTING";this.COM_CONNECTED="COM_CONNECTED";this.COM_FAILED="COM_FAILED";this.SYNC_NOTREADY="SYNC_NOTREADY";this.SYNC_READY="SYNC_READY";this.SYNC_INPROGRESS="SYNC_INPROGRESS";this.SYNC_SUCCESS="SYNC_SUCCESS";this.SYNC_FAILED="SYNC_FAILED";this.comStatus=this.COM_NOTINITIALIZED;this.ed=new b();this.comReady=false;this.comStatus=this.COM_NOTINITIALIZED;this.syncReady=false;this.syncStatus=this.SYNC_NOTREADY;this.debugTry=0;this.isListener=(window.self===window.top);this.cfg={elmID:"__tms__div__",xconID:"omnixd",height:8,width:8,xconURL:"http://localhost/Brand_Agnostic_COD/web/cod_3_0/sync.html",xconSecureURL:"https://localhost/Brand_Agnostic_COD/web/cod_3_0/sync.html"}};c.prototype.init=function(d){if(d){this.cfg=a(this.cfg,d)}this.initCom();this.initSync()};c.prototype.createListener=function(e,f,d){return function(){var g=Array.prototype.slice.call(arguments);if(d){if(typeof d.slice!=="function"){d=[d]}g=g.concat(d)}f.apply(e,g)}};c.prototype.initCom=function(){if(this.isListener){Log.info("xd::initCom => Is Listener so listen");var d=this.createListener(this,this.receiveMessage);if(window.addEventListener){window.addEventListener("message",d,false)}else{window.attachEvent("onmessage",d)}}Log.info("xd::initCom => set Connected");this.setComStatus(this.COM_CONNECTED)};c.prototype.initSync=function(){var d;d=this.createListener(this,this.sendSyncReady);Log.info("initSync => add OnLoad Event - no sync");this.addOnLoadEvent(d)};c.prototype.addOnLoadEvent=function(d){if(typeof d!="function"){return}if(document.readyState==="complete"){d()}else{if(window.attachEvent){window.attachEvent("onload",d)}else{if(window.addEventListener){window.addEventListener("load",d,false)}else{document.addEventListener("load",d,false)}}}};c.prototype.embedSyncIFrame=function(){Log.info("xd::embedSyncIFrame => start embed");var g=this.cfg,i=(window.self.location.protocol==="https:")?g.xconSecureURL:g.xconURL,k,h,f,d=g.elmID;k=document.createElement("iframe");k.setAttribute("src",i);k.setAttribute("id",g.elmID);k.style.width=g.width+"px";k.style.height=g.height+"px";k.style.position="fixed";k.style.top="8px";k.style.left="8px";k.style.overflow="hidden";k.style.display="none";k.style["z-index"]=3001;f=document.getElementsByTagName("body");if(f.length>0){try{f[0].appendChild(k)}catch(j){baker("embed failed")}}};c.prototype.dispatchStatus=function(f,d){var g={type:f,target:this,status:d};this.ed.dispatchEvent(g)};c.prototype.dispatchResults=function(d){if(d&&d.status){var f={type:this.SYNC_RESULTS_EVENT,target:this,data:d};this.ed.dispatchEvent(f)}else{}};c.prototype.dispatchReceiveMessage=function(d){if(d&&d.cmd){if(!d.args){d.args=[]}var f={type:this.RECEIVE_XD_MESSAGE_EVENT,target:this,data:d};this.ed.dispatchEvent(f)}else{}};c.prototype.parseResultObject=function(d){var e={};if(d&&d.length>0&&d[0]){e=d[0]}if(e){if(!e.status){e.status=""}if(!e.pref){e.pref="None"}}return e};c.prototype.receiveMessage=function(d){Log.info("xd::receiveMessage");Log.info(d);var j,g,i=(d)?d.data:"",f="none";if(typeof i==="string"){if(i.length>5&&i.substr(0,1)=="{"){try{j=JSON.parse(i)}catch(h){Log.info("xd::receiveMessage -> JSON Error");Log.info(h)}}}else{j=i}if(j&&j.cmd){f=j.cmd}if(j&&!j.args){j.args=[]}switch(f){case"syncPref_Results":Log.info("xd::syncPref_Results");g=this.parseResultObject(j.args);Log.info(g);this.dispatchResults(g);break;case"syncPref_Ready":Log.info("xd::syncPref_Ready");this.sendSyncReady();break;case"none":break;default:this.dispatchReceiveMessage(j)}};c.prototype.sendSyncReady=function(){this.setSyncStatus(this.SYNC_READY)};c.prototype.addEventListener=function(d,e){return this.ed.addEventListener(d,e)};c.prototype.removeEventListener=function(d,e){return this.ed.removeEventListener(d,e)};c.prototype.sync=function(e,d){Log.info("XD::sync =>"+e+", "+d);this.dispatchResults({status:"OK"});this.setSyncStatus(this.SYNC_SUCCESS)};c.prototype.sendXDMessage=function(d){this.callParent(d)};c.prototype.callParent=function(h){var f=window,j="*",d;if(window.JSON&&JSON.stringify){try{d=JSON.stringify(h)}catch(i){d=h}}try{f.parent.postMessage(d,j);while(f.parent!=window.top){f=f.parent;f.parent.postMessage(d,j)}}catch(g){Log.info("cannot call parent")}};c.prototype.setComStatus=function(d){Log.info("setComStatus status:"+d);this.comStatus=d;this.comReady=(this.comStatus==this.COM_CONNECTED)?true:false;this.dispatchStatus(this.COM_STATUS_EVENT,this.comStatus)};c.prototype.setSyncStatus=function(d){Log.info("setSyncStatus status:"+d);this.syncStatus=d;this.syncReady=(this.syncStatus!=this.SYNC_NOTREADY)?true:false;this.dispatchStatus(this.SYNC_STATUS_EVENT,this.syncStatus)};return c})(tmsomnixd.classes.EventDispatcher,tmsomnixd.utils.mergeObject);if(!window.tmsomnixd){window.tmsomnixd={}}if(!tmsomnixd.default_config){tmsomnixd.default_config={}}(function(c,b){var d,a;d=b(window.location.host);a=(window.top===window.self);c.default_config={isListener:a,cookie:{name:"s_vi",expire:3000,domain:d,path:"/",maxAttempts:6,pollInterval:250},fallback:{fbURL:"http://localhost/cod_3_0/js/2_0/cod.js",fbSecureURL:"http://localhost/cod_3_0/js/2_0/cod.js"},h5conn:{elmID:"__tms__div__",xconID:"omnixd",height:8,width:8,xconURL:"http://localhost/cod_3_0/sync.html",xconSecureURL:"https://localhost/cod_3_0/sync.html"},ns:"s",fireTag:{},MediaTrack:{playerName:"dev"},senderConnectionDelay:1500,listenerConnectionDelay:0}})(tmsomnixd,tmsomnixd.utils.getDomain);(function(K){var l={},y=false,j=false,d=false,g=(window.self===window.top),I,B,u,x,O,p,M,v,E,n,F,f,a,m;function k(){if(y){return}y=true;Log.info("sync");var q=t();E.sync(q,m)}function b(q){if(q&&q.status){Log.info("handleComStatus status:"+q.status);if(q.status==E.COM_CONNECTED||q.status==E.COM_FAILED){L()}}else{Log.warn("handleComStatus no status")}}function w(q){if(q&&q.status){Log.info("handleSyncStatus status:"+q.status);if(q.status==E.SYNC_READY||q.status==E.SYNC_FAILED){L()}}else{Log.warn("handleSyncStatus no status")}}function G(q){var R=q.data;Log.info("handleSyncResults status:"+R.status);if(R.status=="UPDATE"){j=false;B("s_vi",R.pref);N()}else{if(R.status=="CREATE_NEW"){j=true;P()}else{j=false;N()}}}function o(q){if(q&&q.data){var R=q.data;if(R&&R.cmd&&R.args){Log.info("handleXDMessage heard event with "+R.cmd);Q(R.cmd,R.args);L()}else{Log.info("handleXDMessage heard event with improperly formatted data")}}else{Log.info("handleXDMessage heard event with no data")}}function P(){if(g){if(!I&&F.getAmountQueued()>0){Log.info("preprocessQueued");var q=F.dequeue();c(q);H()}else{if(I){Log.info("preprocessQueued => do nothing - Already preproceesing queue")}if(F.getAmountQueued()>0){Log.info("preprocessQueued => do nothing - Nothing Queued")}}}else{Log.info("call parent")}}function C(R){var q=t();Log.info("prefCheck pref:"+q);if(q.length>0){R.target.setResult(v.SUCCESS)}else{R.target.setResult(v.CONTINUE)}}function J(R){if(R.type===v.EVENT_SUCCESS){Log.info("read new local pref = save to remote pref");var q=t();E.sync(q,m)}else{Log.info("cannot read local pref - just process the queue")}I.removeEventListener(v.EVENT_CHECK,C);I.removeEventListener(v.EVENT_SUCCESS,J);I.removeEventListener(v.EVENT_FAILED,J);I=null;N()}function H(){if(!I){I=new v(100,20);I.addEventListener(v.EVENT_CHECK,C);I.addEventListener(v.EVENT_SUCCESS,J);I.addEventListener(v.EVENT_FAILED,J);I.start()}}function c(T){var S,q;if(T&&T.cmd&&T.args){q=(typeof T.args==="string")?JSON.parse(T.args):T.args;S=l[T.cmd];if(typeof S==="function"){try{S.apply(window,q)}catch(R){}}}}function A(q){Log.info("handleQueueUpdate");if(g){Log.info("Listener::makeLocalCall");c(q.data)}else{Log.info("Sender::Send Message to Parent");E.sendXDMessage(q.data)}}function N(){if(F.getAmountQueued()>0){F.process()}}function Q(R,q){Log.info("addToQueue cmd:"+R);F.enqueue({cmd:R,args:q})}function L(){Log.info("initateQueueIfReady");if(E.comReady&&(!g||E.syncReady)){if(!g||(y)){if(!j){Log.info("Ready and Synced = > Process queue");N()}else{Log.info("Ready and Synced but needs new preference = > Pre-Process Queue");P()}}else{Log.info("Ready => Sync");k()}}else{Log.info("Not Ready Yet")}}function t(){return u(f.cookie.name)}function D(q){var R=f.cookie;B(R.name,q,R.expire,R.domain,R.path)}function r(){var R=Math.floor(Math.random()*100),q="_avail",S;B(q,R,f.cookie.domain);S=parseInt(u(q),10);return(R===S)}function s(R,q){Log.info((f.isListener)?"Listener":"Sender ft("+R+")");if(K.utils&&K.utils.mergeObject&&window.omni_page_var){q=K.utils.mergeObject(window.omni_page_var,q)}Q("fireTag",[R,q]);L()}function h(q,T,S,R){if(K.utils&&K.utils.mergeObject&&window.omni_page_var){R=K.utils.mergeObject(window.omni_page_var,R)}Q("MediaTrack",[q,T,S,R]);L()}function z(){M=K.classes.Queue;v=K.classes.Poll;O=K.classes.H5XD;B=K.utils.writeCookie;u=K.utils.readCookie;x=K.utils.HTML5Support;a=K.utils.includeScript}function i(){E.addEventListener(E.COM_STATUS_EVENT,b);if(f.isListener){E.addEventListener(E.RECEIVE_XD_MESSAGE_EVENT,o);E.addEventListener(E.SYNC_RESULTS_EVENT,G);E.addEventListener(E.SYNC_STATUS_EVENT,w)}E.init(n)}function e(){z();if(K.utils&&K.utils.mergeObject){K.config=K.utils.mergeObject(K.default_config,K.config);f=K.config}if(!x.hasRequired){if(f&&f.fallback&&f.fallback.fbSecureURL&&f.fallback.fbURL){var q=(window.self.location.protocol==="https:")?f.fallback.fbSecureURL:f.fallback.fbURL;a(q)}}else{E=new O();n=f.h5conn;i();g=f.isListener;F=new M();F.addEventListener(M.EVENT_UPDATE,A);l.fireTag=fireTag;l.MediaTrack=MediaTrack;window.fireTag=s;window.MediaTrack=h;window.readPreference=t;window.writePreference=D}}e()})(tmsomnixd);